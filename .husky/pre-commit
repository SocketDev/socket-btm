# Optional checks - can be bypassed with --no-verify for fast local commits.
# Mandatory security checks run in pre-push hook.
#
# Use --no-verify for:
# - History operations (squash, rebase, amend)
# - Emergency hotfixes
# - When tests require binaries that haven't been built yet
#
# Use environment variables to selectively disable:
# - DISABLE_PRECOMMIT_LINT=1 to skip linting
# - DISABLE_PRECOMMIT_TEST=1 to skip testing
#
# Portability Notes:
# - Uses POSIX shell syntax (sh) for cross-platform compatibility
# - Relies on pnpm for cross-platform command execution
# - Avoids bash-specific features (arrays, [[, etc.)
# - Tests with [ ] instead of [[ ]] for POSIX compliance

if [ -z "${DISABLE_PRECOMMIT_LINT}" ]; then
  pnpm lint --staged
else
  echo "Skipping lint due to DISABLE_PRECOMMIT_LINT env var"
fi

if [ -z "${DISABLE_PRECOMMIT_TEST}" ]; then
  # Only run tests if there are staged test files
  pnpm test --staged
else
  echo "Skipping testing due to DISABLE_PRECOMMIT_TEST env var"
fi
